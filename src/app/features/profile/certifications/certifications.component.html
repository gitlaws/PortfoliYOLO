<section
  class="certifications-section"
  [ngClass]="theme"
  aria-label="Professional Certifications"
  [attr.data-theme]="theme"
>
  <!-- Main Carousel Container -->
  <div
    #certGrid
    class="cert-grid"
    [ngClass]="[theme, gridClasses]"
    role="region"
    aria-label="Scrolling certification cards - Click and drag to manually scroll"
    tabindex="0"
    (mouseenter)="onGridMouseEnter()"
    (mouseleave)="onGridMouseLeave()"
    (focus)="onGridFocus()"
    (blur)="onGridBlur()"
  >
    <!-- Certification Cards -->
    <article
      class="cert-card"
      [ngClass]="theme"
      tabindex="0"
      *ngFor="
        let cert of duplicatedCertifications;
        trackBy: trackByCertification;
        let i = index
      "
      [attr.aria-hidden]="i >= certifications.length"
      [attr.aria-label]="cert.name + ' certification card'"
    >
      <!-- Certificate Icon -->
      <div class="cert-icon" [ngClass]="theme">
        <img
          [src]="cert.icon"
          [alt]="cert.altText || cert.name + ' logo'"
          loading="lazy"
          (error)="onImageError($event)"
        />
      </div>

      <!-- Certificate Details -->
      <div class="cert-details">
        <h3 class="cert-title" [ngClass]="theme">{{ cert.name }}</h3>
        <p class="cert-org" [ngClass]="theme">{{ cert.org }}</p>
        <time
          class="cert-date"
          [ngClass]="theme"
          [attr.datetime]="cert.datetime"
        >
          {{ cert.date }}
        </time>
      </div>

      <!-- View Certificate Button -->
      <button
        class="cert-link"
        [ngClass]="theme"
        type="button"
        (click)="openCertificateModal(cert, $event)"
        [attr.aria-label]="'View certificate for ' + cert.name"
      >
        View Certificate
      </button>
    </article>
  </div>
</section>

<!-- Certificate Modal Dialog -->
<div
  class="modal-overlay"
  [ngClass]="theme"
  *ngIf="isModalOpen"
  role="dialog"
  aria-modal="true"
  [attr.aria-labelledby]="getModalId(selectedCertification)"
  (click)="onModalBackdropClick($event)"
>
  <div class="modal-content" [ngClass]="theme" role="document">
    <!-- Modal Header -->
    <header class="modal-header" [ngClass]="theme">
      <h2
        class="modal-title"
        [ngClass]="theme"
        [id]="getModalId(selectedCertification)"
      >
        {{ selectedCertification?.name }}
      </h2>

      <button
        class="modal-close"
        [ngClass]="theme"
        type="button"
        (click)="closeCertificateModal()"
        aria-label="Close certificate modal"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          aria-hidden="true"
        >
          <path d="M18 6L6 18M6 6l12 12" />
        </svg>
      </button>
    </header>

    <!-- Modal Body -->
    <main class="modal-body">
      <!-- Certificate Information -->
      <section class="certificate-info" [ngClass]="theme">
        <dl class="cert-meta">
          <dt class="visually-hidden">Issuing Organization</dt>
          <dd class="cert-issuer" [ngClass]="theme">
            <strong [ngClass]="theme">Issued by:</strong>
            {{ selectedCertification?.org }}
          </dd>

          <dt class="visually-hidden">Issue Date</dt>
          <dd class="cert-date-modal" [ngClass]="theme">
            <strong [ngClass]="theme">Date:</strong>
            <time [attr.datetime]="selectedCertification?.datetime">
              {{ selectedCertification?.date }}
            </time>
          </dd>
        </dl>
      </section>

      <!-- Certificate Display -->
      <section class="certificate-display" aria-label="Certificate preview">
        <img
          [src]="certificateGifUrl"
          alt="Interactive certificate demonstration"
          class="certificate-gif"
          [ngClass]="theme"
          loading="lazy"
        />
      </section>
    </main>

    <!-- Modal Footer -->
    <footer class="modal-actions" [ngClass]="theme">
      <button
        class="btn-primary"
        [ngClass]="theme"
        type="button"
        (click)="closeCertificateModal()"
      >
        Close
      </button>

      <a
        *ngIf="selectedCertification?.certLink !== '#'"
        [href]="selectedCertification?.certLink"
        class="btn-secondary"
        [ngClass]="theme"
        target="_blank"
        rel="noopener noreferrer"
        [attr.aria-label]="
          'Open ' + selectedCertification?.name + ' certificate in new tab'
        "
      >
        View Original
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          aria-hidden="true"
        >
          <path
            d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"
          />
        </svg>
      </a>
    </footer>
  </div>
</div>

<!-- Screen Reader Helper Text -->
<div class="sr-only" aria-live="polite" aria-atomic="true">
  <span *ngIf="isDragging">Scrolling certification cards</span>
  <span *ngIf="isModalOpen"
    >Certificate modal opened for {{ selectedCertification?.name }}</span
  >
</div>
